<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>diffDOM</title>
  <style>
    .success {
      background-color: green;
    }
    .failure {
      background-color: red;
    }
  </style>
  <script src="TraceLogger.js">
  </script>
  <script src="diffDOM.js">
  </script>
</head>

<body>

  <h1>Test for diffDOM</h1>

  <!-- Add all divs to be compared here two by two -->


  <div>lol<span>ydew<i>hey</i>de</span>
  </div>
  <div>lol
    <p>ydew<b>hey</b>de</p>
  </div>

  <div>
    <p>hello <span>finger</span>
    </p>
  </div>
  <div>
    <p>hello <span>fingers</span>. Welcome!</p>
  </div>


  <div><span><p>tello</p><p></p></span>
  </div>
  <div><span><p>fello</p><p></p></span>
  </div>

  <div>
    <img>
  </div>
  <div><i><i><img><p></p></i><span><p><p></p></p></span>
    </i><b></b>
  </div>

  <div><b></b>
  </div>
  <div><i><i><b></b><p></p></i><span><p><p></p></p></span>
    </i><b></b>
  </div>

  <div><span>hello</span>
  </div>
  <div>
    <p>hello</p>
  </div>

  <div>
    <img>
    <p></p>
  </div>
  <div>
    <img>
    <p></p>
    <p></p>
  </div>

  <div><b><p></p><b><img><p><span></span></p>XW</b><span>Jl</span><b></b></b>h5QnXX</b>
  </div>
  <div><span><span><b><i></i></b><img><i><span></span>
    </i>
    </span>
    </span><b><p></p>z</b><span><b></b><img></span>2
    <img>
  </div>

  <div><i><p><span>j0zF<b></b></span><i><span></span></i>LS</p>scKvb</i><b>vO8</b>G</div>
  <div>
    <img><span></span>
  </div>

  <div>sSp<span></span>
  </div>
  <div>
    <p>
      <p><span><i>eq</i>okfHoePCoqFZ4<img></span>
        <p></p>YT</p>
      <p>bdMa</p>R</p>
    <img>gv
    <img>
  </div>


  <div>
    <p></p>
    <p><span>j</span><span>Ukoy</span><b>x4KwW</b>
      <img>hWQ</p><b><img><b></b></b>d2HPWS4</div>
  <div>
    <p>
      <p></p>
    </p>
    <p><span>j</span><span>Ukoy</span><b>x4KwW</b>
      <img>hWQ</p><b><img><b></b></b>d2HPWS4</div>

  <div><i><img></i>iXMXSe4nqp</div>
  <div><i><b></b><b><b></b><i><i>Lrjl1pP</i>Y0B</i>xN</b><i></i><span>gwcD4Bj</span><i>A</i>QW6awpo</i>
    <img>
    <p>Z</p>b
    <p></p>7f9</div>

  <div>
    <p></p>
    <p><i></i>
    </p>
    <p></p><i><img><span><b></b></span><img></i>
    <p></p><i><img><span></span></i>
    <p><i></i>
    </p>
    <p></p>
    <img><span><span></span></span>
    <img>
  </div>
  <div>
    <img><i></i>
    <p><span><span><b></b></span></span>
    </p>
    <p></p><b><img><span></span></b>
    <p><b></b>
    </p>
    <p></p>
    <p></p>
    <p>wg</p><i><p></p></i>2nJ<i><img></i>
    <p></p><i><img></i>zV87J1UU3Ex</div>

  <div><span><b><p></p></b>pGy<p></p></span><span><span><span></span></span><i></i><i></i>
    </span><span></span>
    <img>
  </div>
  <div><i></i>
    <img>
    <img><i><i><b></b></i>
    <p></p>
    </i><b></b>
    <p></p>
    <p></p><span></span>
  </div>


  <div>
    <img><i></i><b></b><i></i><font></font>
    <p></p>
    <p></p><span></span>
  </div>
  <div>
    <p></p>
    <p></p><span></span>
    <img><i></i><b></b><i></i><font></font>
  </div>


  <div>
    <img><i></i>
    <p><span><span><b></b></span></span>
    </p>
    <p></p><b><img><span></span></b>
    <p><b></b>
    </p>
    <p></p>
    <p></p>
    <p>wg</p><i><p></p></i>2nJ<i><img></i>
    <p></p><i><img></i>
  </div>
  <div>
    <img><i></i>
    <p><span><span><b></b></span></span>
    </p>
    <p></p><b><img><span></span></b>
    <p><b></b>
    </p>
    <p></p>
    <p></p>
    <p>wg</p><i><p></p></i>2nJ<i><img></i>
    <p></p><i><img></i>zV87J1UU3Ex</div>

  <div id="t1">lol<span>ydew<i>hey</i>de</span>
  </div>
  <div id="t2">lol
    <p>ydew<b>hey</b>de</p>
  </div>


  <div>
    <p><b><i><b><i>ya</i></b><i>f</i></i><span><i></i></span>
      </b>
    </p>
    <p></p>
    <p></p>
    <p></p><span><p><i></i></p>w7U0Ah4<i></i></span><b><p><span></span><img></p></b>
    <p></p>
    <img><i></i><span></span>
  </div>
  <div>
    <img><span><i></i><span></span></span>
    <img><span></span><i></i>
    <p></p>
  </div>

  <div>
    <p></p>
    <img>
    <p></p>
    <p></p>
    <p></p><i></i><span></span>
  </div>
  <div>
    <img><span><i></i><span></span></span>
    <img><span></span><i></i>
    <p></p>
  </div>

  <div>
    <img>
    <p></p>
    <p></p>
    <p></p>
    <p></p><i></i><span></span>
  </div>
  <div>
    <img><span><i></i><span></span></span>
    <img><span></span><i></i>
    <p></p>
  </div>

  <div>
    <img><span><i></i><span></span></span>
    <img>
    <p></p>
    <p></p>
    <p></p>
    <p></p><i></i><span></span>
  </div>
  <div>
    <img><span><i></i><span></span></span>
    <img><span></span><i></i>
    <p></p>
  </div>


  <div>
    <p></p><i></i><span></span>
  </div>
  <div><span></span><i></i>
    <p></p>
  </div>

  <div><span></span><i></i>
    <p></p>
  </div>
  <div><i></i>
    <p></p><span></span>
  </div>

  <div><i></i>
    <p></p><span></span>
  </div>
  <div><span></span><i></i>
    <p></p>
  </div>


  <div><i></i><span></span>
    <p></p>
  </div>
  <div><span></span><i></i>
    <p></p>
  </div>


  <div><b><span><p></p><p><img><b></b>
    </p><b><p></p></b><i></i>
    <p></p>
    <p><b></b><i>YgXxj0</i>
    </p>
    <p><i><span></span></i>
    </p><i><b><span><img></span><p></p><img></b><b>11w</b>ymd</i>
    <p></p>
    <p><span></span><span></span>
    </p>
    <p></p>
    <p></p>
    <p></p>
    <p>gU</p><span></span></span>Jbrr7</b>
  </div>
  <div><span><span><p>UPG</p><img><img></span><span></span><span></span></span>
    <p>vZR6</p>
    <p><b><span><img></span>JvrBR</b>
    </p>
    <p></p>
    <p></p>
    <p>WB6Y</p>
    <img>
    <img><i></i>
    <p></p>
    <p>
      <img>
      <img><b></b>
    </p>
    <p><b>dh62z</b>
    </p>
    <p></p>
    <p></p><b><img></b>YD
    <p></p>
  </div>

  <div>7</div>
  <div><i><img><i><p></p><span></span></i><span>uW<span class="dd-sep"></span>Dc</span>
    <img>
    <img>
    <p>
      <img><i></i><i></i>
    </p>
    <p></p><i></i><span>SC<span class="dd-sep"></span>vEq<span class="dd-sep"></span>M1VRx<span class="dd-sep"></span>c81B</span>T
    <p></p><span><p><img><b></b>FW</p></span>taV</i><i><p></p>6k<span class="dd-sep"></span>Mycc</i>
    <img>
    <img>9JI</div>

  <div><span><img><b><p></p><span class="dd-sep"></span>b</b>82</span><b><b><p><b></b>
    </p>
    <p></p>
    <p></p><b>XO<i></i></b></b>2</b>
  </div>
  <div><span><p><b></b><b></b><i></i></p><b></b><i></i>dsL</span><span><span></span>2z</span>
    <img>
    <p>J</p>
    <p><b></b>Hmr<span class="dd-sep"></span>p4</p><span></span>
    <p>
      <img>I</p><span></span>
    <p></p>
    <img>
    <img>
  </div>

  <div id="document-contents" class="editable user-contents" contenteditable="true">
    <p>Andd here some contents<span class="equation" data-equation="x=2*y"><span class="MathJax_Preview"></span>
      <script type="math/tex" id="MathJax-Element-1">
        x = 2 * y
      </script>
      </span>᠎ wewe <span class="equation" data-equation="x=2*y"><span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" role="textbox" aria-readonly="true" style="font-size: 120%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 -676 3872 891" style="width: 8.993ex; height: 2.069ex; vertical-align: -0.575ex; margin: 1px 0px;"><g stroke="black" fill="black" stroke-thickness="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-78"></use><use x="854" y="0" xlink:href="#MJMAIN-3D"></use><use x="1915" y="0" xlink:href="#MJMAIN-32"></use><use x="2642" y="0" xlink:href="#MJMAIN-2217"></use><use x="3370" y="0" xlink:href="#MJMATHI-79"></use></g></svg></span>
      <script type="math/tex" id="MathJax-Element-2">
        x = 2 * y
      </script>
      </span>᠎ and tdedherdeefore we went skiing that year. That's quite a new thing for us though. sdasdasddsadd</p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>desadsad</p>
  </div>
  <div id="document-contents" class="editable user-contents" contenteditable="true">
    <p>Andd here some contents<span class="equation" data-equation="x=2*y"><span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" role="textbox" aria-readonly="true" style="font-size: 120%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 -676 3872 891" style="width: 8.993ex; height: 2.069ex; vertical-align: -0.575ex; margin: 1px 0px;"><g stroke="black" fill="black" stroke-thickness="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-78"></use><use x="854" y="0" xlink:href="#MJMAIN-3D"></use><use x="1915" y="0" xlink:href="#MJMAIN-32"></use><use x="2642" y="0" xlink:href="#MJMAIN-2217"></use><use x="3370" y="0" xlink:href="#MJMATHI-79"></use></g></svg></span>
      <script type="math/tex" id="MathJax-Element-1">
        x = 2 * y
      </script>
      </span>᠎ wewe <span class="equation" data-equation="x=2*y"><span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" role="textbox" aria-readonly="true" style="font-size: 120%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 -676 3872 891" style="width: 8.993ex; height: 2.069ex; vertical-align: -0.575ex; margin: 1px 0px;"><g stroke="black" fill="black" stroke-thickness="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-78"></use><use x="854" y="0" xlink:href="#MJMAIN-3D"></use><use x="1915" y="0" xlink:href="#MJMAIN-32"></use><use x="2642" y="0" xlink:href="#MJMAIN-2217"></use><use x="3370" y="0" xlink:href="#MJMATHI-79"></use></g></svg></span>
      <script type="math/tex" id="MathJax-Element-2">
        x = 2 * y
      </script>
      </span>᠎ and tdedherdeefore we went skiing that year. That's quite a new thing for us though. sdasdasddsadd</p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>
      <br>
    </p>
    <p>desadsad</p>
  </div>



  <div><span></span>hall<span></span>
  </div>
  <div><span></span>hallo<span></span>
  </div>



  <script>
    function reportDiv() {
      document.body.appendChild(document.createElement('div'));
    }

    function testSuccess() {
      document.body.lastChild.classList.add('success');
    }

    function testFailure() {
      document.body.lastChild.classList.add('failure');
    }

    function print(text) {
      var par = document.createElement('p');
      par.textContent = text;
      document.body.lastChild.appendChild(par);
    }

    var dd = new diffDOM(true, 500),
      tl = new TraceLogger(dd),
      divNodeList, divs = [],
      diffs, t1, i;

    divNodeList = document.querySelectorAll('div');

    for (i = 0; i < divNodeList.length; i++) {
      divs[i] = divNodeList[i];
      divs[i].parentNode.removeChild(divs[i]);
    }

     // Adding test nodes that contain sibling text nodes
    divs = divs.concat([
      objToNode(JSON.parse('{"nn":"DIV","a":[["id","document-editable"]],"c":[{"nn":"DIV","a":[["id","document-title"],["class","editable user-contents"],["title","The title of the document"],["contenteditable","true"]],"c":[{"t":"Hellofglalak"}]},{"nn":"DIV","a":[["id","document-metadata"],["class","user-contents"]]},{"nn":"DIV","a":[["id","document-contents"],["class","editable user-contents"],["contenteditable","true"]],"c":[{"nn":"P","c":[{"t":"I want a new Finisky is a German writer. Finish laundromats. French steel plants kate -- spiegel overrated. Howe"},{"t":"ver, the essential parts are good Danish roses. And Swedish steel. Bitcoin Claustrophobic Visions (BCC). Aftenposten regner, bicycle. It\'s really easy to do.  University finals are a discipline of their own. Bortsch ist something I would like to eat during winter. fellxDAGBBloneHONEZDzow. And so thdededeey went to M"},{"nn":"SPAN","a":[["class","comment"],["id","comment-0"],["data-id","0"],["data-user","1"],["data-user-name","johannes"],["data-user-avatar","/static/img/default_avatar.png"],["data-date","1388568971084"],["data-comment","test"]],"c":[{"t":"unichmel"}]},{"t":"lom "},{"nn":"SPAN","a":[["class","citation"],["data-bib-entry","1"],["data-bib-before",""],["data-bib-page","123"],["data-bib-format","autocite"]]},{"t":" jfllfrjc"},{"nn":"SPAN","a":[["class","equation"],["data-equation","\\frac{2}{3}"]]},{"t":" aftfellowen"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" deAftend"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" etigeren"}]},{"nn":"P","c":[{"t":"lalalalala"},{"nn":"SPAN","a":[["class","footnote"]],"c":[{"t":"a footnote "},{"nn":"BR"}]},{"t":"dsdfdsfllasdsBerchtesgardener Lichtspiele. Flensburger Nahverkehr.qwedw casdsdwqqw"}]}]}]}')),
      objToNode(JSON.parse('{"nn":"DIV","a":[["id","document-editable"]],"c":[{"nn":"DIV","a":[["id","document-title"],["class","editable user-contents"],["title","The title of the document"],["contenteditable","true"]],"c":[{"t":"Hellofglalak"}]},{"nn":"DIV","a":[["id","document-metadata"],["class","user-contents"]]},{"nn":"DIV","a":[["id","document-contents"],["class","editable user-contents"],["contenteditable","true"]],"c":[{"nn":"P","c":[{"t":"I want a new Finisky is a German writer. Finish laundromats. French steel plants kate -- spiegel overrated. Howe"},{"t":" "},{"t":"ver, the essential parts are good Danish roses. And Swedish steel. Bitcoin Claustrophobic Visions (BCC). Aftenposten regner, bicycle. It\'s really easy to do.  University finals are a discipline of their own. Bortsch ist something I would like to eat during winter. fellxDAGBBloneHONEZDzow. And so thdededeey went to M"},{"nn":"SPAN","a":[["class","comment"],["id","comment-0"],["data-id","0"],["data-user","1"],["data-user-name","johannes"],["data-user-avatar","/static/img/default_avatar.png"],["data-date","1388568971084"],["data-comment","test"]],"c":[{"t":"unichmel"}]},{"t":"lom "},{"nn":"SPAN","a":[["class","citation"],["data-bib-entry","1"],["data-bib-before",""],["data-bib-page","123"],["data-bib-format","autocite"]]},{"t":" jfllfrjc"},{"nn":"SPAN","a":[["class","equation"],["data-equation","\\frac{2}{3}"]]},{"t":" aftfellowen"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" deAftend"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" etigeren"}]},{"nn":"P","c":[{"t":"lalalalala"},{"nn":"SPAN","a":[["class","footnote"]],"c":[{"t":"a footnote "},{"nn":"BR"}]},{"t":"dsdfdsfllasdsBerchtesgardener Lichtspiele. Flensburger Nahverkehr.qwedw casdsdwqqw"}]}]}]}')),
    ]);

    divs = divs.concat([
      objToNode(JSON.parse('{"nn":"DIV","a":[["id","document-editable"]],"c":[{"nn":"DIV","a":[["id","document-title"],["class","editable user-contents"],["title","The title of the document"],["contenteditable","true"]],"c":[{"t":"Hellofglalak"}]},{"nn":"DIV","a":[["id","document-metadata"],["class","user-contents"]]},{"nn":"DIV","a":[["id","document-contents"],["class","editable user-contents"],["contenteditable","true"]],"c":[{"nn":"P","c":[{"t":"I want a new Finisky is a German writer. Finish laundromats. French steel plants kate -- spiegel overrated. Howe"},{"t":" "},{"t":"ver, the essential parts are good Danish roses. And Swedish steel. Bitcoin Claustrophobic Visions (BCC). Aftenposten regner, bicycle. It\'s really easy to do.  University finals are a discipline of their own. Bortsch ist something I would like to eat during winter. fellxDAGBBloneHONEZDzow. And so thdededeey went to M"},{"nn":"SPAN","a":[["class","comment"],["id","comment-0"],["data-id","0"],["data-user","1"],["data-user-name","johannes"],["data-user-avatar","/static/img/default_avatar.png"],["data-date","1388568971084"],["data-comment","test"]],"c":[{"t":"unichmel"}]},{"t":"lom "},{"nn":"SPAN","a":[["class","citation"],["data-bib-entry","1"],["data-bib-before",""],["data-bib-page","123"],["data-bib-format","autocite"]]},{"t":" jfllfrjc"},{"nn":"SPAN","a":[["class","equation"],["data-equation","\\frac{2}{3}"]]},{"t":" aftfellowen"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" deAftend"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" etigeren"}]},{"nn":"P","c":[{"t":"lalalalala"},{"nn":"SPAN","a":[["class","footnote"]],"c":[{"t":"a footnote "},{"nn":"BR"}]},{"t":"dsdfdsfllasdsBerchtesgardener Lichtspiele. Flensburger Nahverkehr.qwedw casdsdwqqw"}]}]}]}')),
      objToNode(JSON.parse('{"nn":"DIV","a":[["id","document-editable"]],"c":[{"nn":"DIV","a":[["id","document-title"],["class","editable user-contents"],["title","The title of the document"],["contenteditable","true"]],"c":[{"t":"Hellofglalak"}]},{"nn":"DIV","a":[["id","document-metadata"],["class","user-contents"]]},{"nn":"DIV","a":[["id","document-contents"],["class","editable user-contents"],["contenteditable","true"]],"c":[{"nn":"P","c":[{"t":"I want a new Finisky is a German writer. Finish laundromats. French steel plants kate -- spiegel overrated. Howe"},{"t":"ver, the essential parts are good Danish roses. And Swedish steel. Bitcoin Claustrophobic Visions (BCC). Aftenposten regner, bicycle. It\'s really easy to do.  University finals are a discipline of their own. Bortsch ist something I would like to eat during winter. fellxDAGBBloneHONEZDzow. And so thdededeey went to M"},{"nn":"SPAN","a":[["class","comment"],["id","comment-0"],["data-id","0"],["data-user","1"],["data-user-name","johannes"],["data-user-avatar","/static/img/default_avatar.png"],["data-date","1388568971084"],["data-comment","test"]],"c":[{"t":"unichmel"}]},{"t":"lom "},{"nn":"SPAN","a":[["class","citation"],["data-bib-entry","1"],["data-bib-before",""],["data-bib-page","123"],["data-bib-format","autocite"]]},{"t":" jfllfrjc"},{"nn":"SPAN","a":[["class","equation"],["data-equation","\\frac{2}{3}"]]},{"t":" aftfellowen"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" deAftend"},{"nn":"SPAN","a":[["class","equation"],["data-equation","x=2*y"]]},{"t":" etigeren"}]},{"nn":"P","c":[{"t":"lalalalala"},{"nn":"SPAN","a":[["class","footnote"]],"c":[{"t":"a footnote "},{"nn":"BR"}]},{"t":"dsdfdsfllasdsBerchtesgardener Lichtspiele. Flensburger Nahverkehr.qwedw casdsdwqqw"}]}]}]}')),
    ]);


    for (i = 0; i < divs.length; i = i + 2) {


      try {
        reportDiv();
        print("diff operations for div #" + i + " -> div #" + (i + 1));
        diffs = dd.diff(divs[i], divs[i + 1]);
        console.log(diffs);

        print("applying...");
        t1 = divs[i].cloneNode(true);
        dd.apply(t1, diffs);

        if (t1.innerHTML === divs[i + 1].innerHTML) {
          print('...success!');
        } else {
          testFailure();
          console.log(diffs);
          console.log(t1.outerHTML);
          console.log(divs[i + 1].outerHTML);
          throw 'Outputs not matching';
        }

        print("undoing...");
        dd.undo(t1, diffs);

        if (t1.innerHTML === divs[i].innerHTML) {
          print('...success!');
          testSuccess();
        } else {
          testFailure();
          console.log(diffs);
          console.log(t1.outerHTML);
          console.log(divs[i].outerHTML);
          throw 'Outputs not matching';
        }
        //try {
      } catch (e) {
        console.log("error occured\n", e.toString());
        console.log(tl.toString());
        throw e;
      }
    }
  </script>

</body>

</html>
